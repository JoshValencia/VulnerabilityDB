import React, { useEffect } from "react";
import Head from "next/head";
import { Vulnerabilities } from "../data";
import styles from "@/styles/Vulnerability.module.css";
import ReactMarkdown from "react-markdown";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { vscDarkPlus } from "react-syntax-highlighter/dist/cjs/styles/prism";
import remarkGfm from "remark-gfm";

export default function Vulnerability({ vulnerability, list }) {
  const getVulnerability = async () => {
    const res = await fetch("/api/scrape", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(vulnerability),
    });
    const result = await res.json();
    console.log(result);
  };

  //   getVulnerability();

  return (
    <>
      <Head>
        <title>{vulnerability.summary}</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <nav>
        <a href="/" className="main-nav-home">
          Jit Vulnerability DB
        </a>
        <div className="main-nav-links">
          {list.map((vuln, i) => {
            return (
              <a href={"/vuln/" + vuln.id} key={i}>
                {vuln.name}
              </a>
            );
          })}
        </div>
      </nav>
      <main>
        <section className={styles.v_section}>
          <h1 className="text-4xl text-bold">
            {vulnerability.database_specific.cwe_ids[0]}
          </h1>
          <h2 className="text-4xl text-bold">{vulnerability.summary}</h2>
          <p></p>
          <button>Sample CTA</button>
        </section>
        <section className={styles.v_section}>
          {/* Jit Tool */}
          <h2>Npm Audit</h2>
          <p>
            Run a security audit of the dependencies configured in your project
            to your default registry and asks for a report of known
            vulnerabilities.
          </p>
        </section>
        <section className={styles.v_section}>
          {/* Vulnerability Type */}
          <h2>{vulnerability.severity[0].type}</h2>

          <div className="vulnerabilityDescription">
            <ReactMarkdown
              remarkPlugins={[remarkGfm]}
              components={{
                code({ node, inline, className, children, ...props }) {
                  const match = /language-(\w+)/.exec(className || "");
                  return !inline && match ? (
                    <SyntaxHighlighter
                      style={vscDarkPlus}
                      language={match[1]}
                      PreTag="div"
                      {...props}
                    >
                      {String(children).replace(/\n$/, "")}
                    </SyntaxHighlighter>
                  ) : (
                    <code className={className} {...props}>
                      {children}
                    </code>
                  );
                },
              }}
            >
              {vulnerability.details}
            </ReactMarkdown>
          </div>

          {/* Render the Markdown content */}
        </section>
        <section className={styles.v_section}>
          {/* Vulnerability Layer */}
          {vulnerability.affected.map((a, i) => {
            return (
              <div key={i}>
                <h2>{a.package.ecosystem}</h2>
                <p>{a.package.name}</p>
              </div>
            );
          })}
        </section>
        <section className={styles.v_section}>
          {vulnerability.references.map((r, i) => {
            return (
              <a href={r.url} key={i}>
                {r.type}
              </a>
            );
          })}
        </section>
        <section className={styles.v_section}>
          <a href="https://www.jit.io/security-tools">Jit Security Tools</a>
          <button>CTA Sample</button>
        </section>
      </main>
    </>
  );
}
