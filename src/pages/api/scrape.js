import puppeteer from "puppeteer";

const scrapePage = async function (req, res) {
  if (req.method === "POST") {
    const vulnerability = req.body;
    const CWE = vulnerability.database_specific.cwe_ids[0].split("-")[1];
    const browser = await puppeteer.launch();
    const page = await browser.newPage();

    await page.goto(`https://cwe.mitre.org/data/definitions/${CWE}.html`);

    // Get the title of the page
    const title = await page.title();

    // Get the text content of an element on the page
    // const element = await page.$(".some-element-selector");
    // const textContent = await element.textContent();

    // // Get the source URL of an image on the page
    // const image = await page.$(".some-image-selector");
    // const imageUrl = await image.evaluate((node) => node.getAttribute("src"));

    await browser.close();

    res.send({ title });
  } else {
    res.end({ test: "test" });
  }
};

export default scrapePage;
